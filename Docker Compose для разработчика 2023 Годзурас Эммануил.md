parent: [[Книги]]

Разработка программного обеспечения становится все сложнее из-за использования различных инструментов. Приложения приходится упаковывать вместе
с программными компонентами, чтобы упростить их работу, но это усложняет
их запуск. С помощью Docker Compose можно всего одной командой настроить
приложение и необходимые зависимости.
Вы познакомитесь с основами томов и сетей Docker, с командами Compose, их
назначением и вариантами использования. Настроите базу данных для повседневной работы, доступную через сеть Docker, установите связь между микросервисами. 
Научитесь с помощью Docker Compose запускать целые стеки локально,
моделировать промышленные окружения и расширять задания CI/CD. Кроме
того, узнаете, как извлечь выгоду из Docker Compose при создании развертываний
в промышленных окружениях, а также подготовите инфраструктуру в общедоступных облаках.
Издание предназначено программистам и инженерам DevOps, которые желают
научиться настраивать многоконтейнерные приложения Docker. Оно также будет
полезно руководителям групп, стремящимся повысить продуктивность команд
разработки.

Docker Compose – это инструмент для определения и запуска многоконтейнерных приложений Docker. Конфигурация определяется с помощью файлов
YAML, а с помощью утилиты командной строки Docker Compose можно
определять и выполнять операции с контейнерами, управляемыми Docker
Compose.

стр.27 На GitHub можно найти проект (https://github.com/docker/compose)
- Compose интегрируется с Docker CLI как плагин;
- Compose взаимодействует с Docker Engine через API;
- Compose предоставляет интерфейс командной строки и преобразует
- команды в вызовы Docker Engine API;
- Compose читает файл Compose в формате YAML и генерирует описанные в нем ресурсы;
- Compose предоставляет слой для преобразования команд docker-compose
- в CLI-совместимые аналоги;
- Compose взаимодействует с объектами Docker и различает их с помощью меток.

стр. 33
Имя файла играет важную роль. Мы использовали команду Compose, чтобы
проанализировать файл Compose, но не указали имя этого файла. Так же, как
в случае с командой docker build и файлом Dockerfile, команда docker compose
будет искать файл с именем docker-compose.yaml в текущем каталоге. Если
файл существует, он будет использован как файл Compose по умолчанию.
Но имейте в виду, что мы не ограничены единственным именем файла; мы
можем использовать любое другое имя файла для наших приложений Compose.

# Основы томов Docker

стр. 59 Но проблема дисковых операций в контейнерах Docker заключается в том, что после закрытия контейнера все изменения теряются. Чтобы этого не происходило, Docker предоставляет тома. Тома являются предпочтительным механизмом хранения данных,
которые создаются и используются контейнером.

Вот некоторые характеристики томов:
- тома и данные в них сохраняются после закрытия контейнера;
- том можно подключить к другому контейнеру;
- тома могут использоваться несколькими контейнерами одновременно;
- тома абстрактны;
- тома могут быть локальными или удаленными.

# Основы сетей Docker

Важнейшей особенностью Docker является его поддержка сетей. Контейнеры, работающие в Docker, могут беспрепятственно обмениваться данными между собой. Благодаря поддержке сетей Docker предоставляет различные сетевые возможности:
- приватные сети;
- внутреннюю службу DNS;
- связь между контейнерами;
- контейнеры, играющие роль мостов между сетями

## Мостовая сеть
Мост – сетевой драйвер, используемый в Docker по умолчанию. Мостовая
сеть в Docker – это программный уровень, обеспечивающий связь между контейнерами, подключенными к одной мостовой сети. Кроме того, эти контейнеры изолированы от контейнеров, не подключенных к этой сети. 
В примере выше, где мы получили список имеющихся сетей, можно увидеть сеть с именем bridge. Это сеть по умолчанию, к которой должны подключаться контейнеры.

Мостовая сеть, определяемая пользователем, выглядит предпочтительнее
сети по умолчанию. Контейнеры определяют сетевые адреса друг друга по
именам или псевдонимам:
- контейнеры подключаются к сети, привязанной к их приложению;
- мостовую сеть можно настроить под нужды приложения.

## Сеть хоста
При использовании сети хоста контейнер Docker не изолируется от хоста, на
котором выполняется. Контейнер не имеет собственного IP-адреса, и доступ
к нему осуществляется с использованием IP-адреса хоста

docker run --rm **--network host** --name host-nginx nginx

## Оверлейная сеть
Сети, которые мы исследовали выше, предназначены для использования в Docker Engine на одном хосте. Для применения Docker в промышленном окружении с механизмом оркестрации, таким как Swarm, необходимо несколько хостов. Оверлейная сеть создает распределенную сеть, охватывающую все эти хосты. Оверлейная сеть прозрачно соединяет сети хостов и создает единую сеть поверх них. 

# Команды управления образами

## Список образов
Наше приложение пока имеет всего две службы, выполняемые в контейнерах. Получить список образов, используемых контейнерами, можно с помощью команды docker compose images

## Извлечение образов

docker compose pull --ignore-pull-failures --parallel

## Локальный реестр Docker в Compose


services:
registry:
image: registry:2
ports:
- 5000:5000

Реестр будет работать на порту 5000, поэтому нужно убедиться, что этот порт доступен в системе. Имейте в виду, что это небезопасный реестр, поэтому нужно отредактировать конфигурацию демона Docker, чтобы явно указать незащищенный реестр.

В Docker Desktop добавить в настройках Docker Engine:
"insecure-registries" : [
"host.docker.internal:5000"
],

стр. 96 Микросервисы – это новая нормальность.

Современные приложения становятся все сложнее и сложнее. Это вынуждает разбивать приложение на несколько частей для лучшего масштабирования или для разработки несколькими командами. Микросервисы – это новая нормальность. Разделив задачу на более мелкие части, команды могут извлечь выгоду из ускорения их решения. Кроме того, микросервисы могут помочь управлять производительностью и масштабированием наиболее важных частей приложения.

